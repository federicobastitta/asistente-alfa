<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Asistente Alfa Sky</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: #0c1330;
      color: #f2f2f2;
      font-family: system-ui, sans-serif;
    }
    #chatContainer {
      width: 100%;
      max-width: 380px;
      height: 600px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      font-size: 14px;
    }
    .input-row {
      display: flex;
      border-top: 1px solid #1c2350;
    }
    input {
      flex: 1;
      padding: 10px;
      border: none;
      background: #0b1028;
      color: #f2f2f2;
      font-size: 14px;
    }
    button {
      padding: 10px;
      border: none;
      background: #d6c08a;
      color: #0a1022;
      cursor: pointer;
      font-weight: bold;
    }
    .msg-bot {
      margin-bottom: 8px;
      padding: 8px;
      background: #1e2646;
      border-radius: 4px;
    }
    .msg-user {
      text-align: right;
      margin-bottom: 8px;
      padding: 8px;
      background: #39417a;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<div id="chatContainer">
  <div class="messages" id="messages"></div>
  <div class="input-row">
    <input type="text" id="userInput" placeholder="EscribÃ­ acÃ¡..." disabled />
    <button id="sendBtn">Enviar</button>
  </div>
</div>

<script>
(() => {
  const wsNumber = "5491135151981";
  const messages = document.getElementById("messages");
  const input = document.getElementById("userInput");
  const btn = document.getElementById("sendBtn");

  let step = 0;
  const info = {};

  function bot(text) {
    messages.innerHTML += '<div class="msg-bot">' + text + "</div>";
    messages.scrollTop = messages.scrollHeight;
  }

  function user(text) {
    messages.innerHTML += '<div class="msg-user">' + text + "</div>";
    messages.scrollTop = messages.scrollHeight;
  }

  function askNext() {
    input.disabled = false;
    input.value = "";
    input.focus();

    switch (step) {
      case 0:
        bot("Hola ðŸ‘‹ Soy el asistente de Alfa Sky. Â¿Desde dÃ³nde estÃ¡s pensando salir?");
        break;
      case 1:
        bot("Perfecto. Â¿Y cuÃ¡l serÃ­a el destino?");
        break;
      case 2:
        bot("Â¿CuÃ¡ntos pasajeros serÃ­an mÃ¡s o menos?");
        break;
      case 3:
        bot("Â¿PreferÃ­s volar en jet o algo mÃ¡s chico como un turbohÃ©lice? Si no sabÃ©s, te ayudo.");
        break;
      default:
        extraInfo();
        finalize();
    }
  }

  function detectAgency(txt) {
    return /agencia|broker|operador|viajes|tour/i.test(txt);
  }

  function extraInfo() {
    const pax = parseInt(info.pasajeros || "0");

    if (pax > 9) {
      bot("Dato importante: si son mÃ¡s de 9 personas, el vuelo lleva un recargo del 30%. Lo tenemos en cuenta.");
    }

    if (info.destino.toLowerCase().includes("punta")) {
      bot("Punta del Este cobra USD 1000 para aterrizar y otros 1000 para despegar. Te lo sumamos bien claro.");
    }

    if (info.tipo && info.tipo.toLowerCase().includes("jet")) {
      bot("RecordÃ¡ que el mÃ­nimo por vuelo en jet es de USD 4000. En turbohÃ©lice es USD 3800.");
    }

    bot("ðŸ•’ Si la vuelta es dentro de las 3 horas, no se cobra. Lo aclaro por si lo tenÃ­as en mente ðŸ˜‰");
  }

  function finalize() {
    const msg = encodeURIComponent(
      `Hola Alfa Sky, quiero cotizar un vuelo:\n\nOrigen: ${info.origen}\nDestino: ${info.destino}\nPasajeros: ${info.pasajeros}\nTipo de aviÃ³n: ${info.tipo}`
    );

    bot("Listo, ya tengo todo lo bÃ¡sico. Si querÃ©s seguir, te paso directo con nuestro equipo por WhatsApp.");
    bot('<a href="https://wa.me/' + wsNumber + '?text=' + msg + '" target="_blank">ðŸ“² Hablar por WhatsApp</a>');
    input.disabled = true;
    btn.disabled = true;
  }

  btn.addEventListener("click", () => {
    const txt = input.value.trim();
    if (!txt) return;

    user(txt);
    input.disabled = true;

    if (step === 0) {
      if (detectAgency(txt)) {
        bot("Gracias por la consulta ðŸ™Œ Como sos agencia o broker, te derivo con un encargado que maneja estos casos especiales.");
        bot('<a href="https://wa.me/' + wsNumber + '" target="_blank">ðŸ“² Contactar por WhatsApp</a>');
        input.disabled = true;
        btn.disabled = true;
        return;
      }
      info.origen = txt;
    } else if (step === 1) {
      info.destino = txt;
    } else if (step === 2) {
      info.pasajeros = txt;
    } else if (step === 3) {
      info.tipo = txt;
    }

    step++;
    askNext();
  });

  askNext();
})();
</script>

</body>
</html>
